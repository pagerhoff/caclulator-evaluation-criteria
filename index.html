import React, { useState } from 'react';
import { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/card';

const ComparisonTool = () => {
    const categories = {
        'Essentials': {
            description: 'Core platform capabilities required for modern financial calculators',
            features: {
                'ADA compliant': {
                    description: 'Are the tools designed to meet compliance needs and constantly tested against new requirements?',
                    chimneyValue: 'Yes',
                    weight: 5,
                    options: ['Yes', 'No', 'Limited']
                },
                'Fully responsive design': {
                    description: 'Responsive design to show up perfectly wherever your customers are: phone, tablet, or computer?',
                    chimneyValue: 'Yes',
                    weight: 4,
                    options: ['Yes', 'No', 'Limited']
                },
                'SEO optimized': {
                    description: 'SEO optimized javascript means your calculators are crawlable and indexable by Google?',
                    chimneyValue: 'Yes',
                    weight: 4,
                    options: ['Yes', 'No']
                },
                'Guaranteed uptime SLA': {
                    description: '99% reliability and uptime included on the MSA?',
                    chimneyValue: 'Yes',
                    weight: 5,
                    options: ['Yes', 'No']
                },
                'Easy to Publish': {
                    description: 'Ability to easily integrate with most CMS: Wordpress, Drupal, etc',
                    chimneyValue: 'Yes',
                    weight: 4,
                    options: ['Yes', 'Requires custom development', 'No']
                },
                'Javascript instead of iFrames': {
                    description: 'Publish using simple javascript code instead of using iFrames?',
                    chimneyValue: 'Yes',
                    weight: 3,
                    options: ['Yes', 'No']
                },
                'Lightning fast load times': {
                    description: 'Rank in the 98th percentile in Google Page Speed Tests?',
                    chimneyValue: 'Yes',
                    weight: 4,
                    options: ['Yes', 'No']
                },
                'No-Code Platform': {
                    description: 'A single dashboard to launch, manage, and measure the entire library of tools?',
                    chimneyValue: 'Yes',
                    weight: 5,
                    options: ['Yes', 'No']
                }
            }
        },
        'Branding': {
            description: 'Customization and branding capabilities',
            features: {
                'Custom Branding (Whitelabel colors)': {
                    description: 'Ensure your calculators match the rest of your website with fully customizable color schemes and choose from 10 standard font options.',
                    chimneyValue: 'Yes',
                    weight: 4,
                    options: ['Yes', 'Requires custom development', 'No']
                },
                'Easily Make Changes or Updates': {
                    description: 'Ability to add new or swap out calculators without working with the development team.',
                    chimneyValue: 'Yes',
                    weight: 4,
                    options: ['Yes', 'No']
                },
                'Upload your logo': {
                    description: 'Ability to upload a custom logo directly onto the calculator?',
                    chimneyValue: 'Yes',
                    weight: 3,
                    options: ['Yes', 'No']
                }
            }
        },
        'Customizations': {
            description: 'Platform customization capabilities',
            features: {
                'No Coding Required': {
                    description: 'Can you make changes or launch new calculators without a backend developer?',
                    chimneyValue: 'Yes',
                    weight: 5,
                    options: ['Yes', 'No']
                },
                'Inputs, Rates, Prepopulated fields': {
                    description: 'Ability to customize the rates, inputs, and components without custom development work?',
                    chimneyValue: 'Yes',
                    weight: 4,
                    options: ['Yes', 'No']
                },
                'API integration for real-time rates': {
                    description: 'Ability to ensure real-time & accurate interest rates with rates API integrations?',
                    chimneyValue: 'Yes',
                    weight: 4,
                    options: ['Yes', 'No']
                },
                'User role permissions': {
                    description: 'Ability to invite your designers, web development agency, or other stakeholders using admin level permission settings?',
                    chimneyValue: 'Yes',
                    weight: 3,
                    options: ['Yes', 'No']
                },
                'Integrations (CRM & Data)': {
                    description: 'Ability to integrated with your Core or CRM to ensure your calculators are connected to the rest of your ecosystem?',
                    chimneyValue: 'Requires custom development',
                    weight: 4,
                    options: ['Yes', 'Requires custom development', 'No']
                }
            }
        },
        'Conversion & Analytics': {
            description: 'Analytics and conversion tracking capabilities',
            features: {
                'Lead Generation': {
                    description: 'Ability to use CTAs embedded within calculators to generate leads?',
                    chimneyValue: 'Yes',
                    weight: 5,
                    options: ['Yes', 'Requires custom development', 'No']
                },
                'Usage Analytics Dashboard': {
                    description: 'A dashboard to see how people are using each calculator?',
                    chimneyValue: 'Yes',
                    weight: 4,
                    options: ['Yes', 'No']
                },
                'Conversion Analytics Dashboard': {
                    description: 'A dashboard to see how many people are converting to start applications, go to product pages, or contact us forms?',
                    chimneyValue: 'Yes',
                    weight: 4,
                    options: ['Yes', 'No']
                },
                'Easily pair with Google Analytics': {
                    description: 'Ability to pair calculator session & conversion data easily with Google Analytics?',
                    chimneyValue: 'Yes',
                    weight: 3,
                    options: ['Yes', 'No']
                },
                'UTM Tracking': {
                    description: 'Ability to easily add UTM tracking to your calculators?',
                    chimneyValue: 'Yes',
                    weight: 3,
                    options: ['Yes', 'No']
                }
            }
        },
        'Support & Maintenance': {
            description: 'Support and maintenance capabilities',
            features: {
                'Time to go live': {
                    description: 'How long does a typical client take to have a custom calculator ready for testing?',
                    chimneyValue: 'Less than 24 hours',
                    weight: 5,
                    options: ['Less than 24 hours', '2-7 days', '1-4 weeks', '1-3 months', '3+ months']
                },
                'SOC 2': {
                    description: 'Is the vendor SOC2 certified?',
                    chimneyValue: 'SOC 2 Certified',
                    weight: 4,
                    options: ['SOC 2 Certified', 'In Process', 'No']
                },
                'Security': {
                    description: 'Hosted with AWS to meet security standards?',
                    chimneyValue: 'Yes',
                    weight: 5,
                    options: ['Yes', 'No']
                },
                'Automatic Product Updates': {
                    description: 'Ability to push updates live automatically without backend dev work required?',
                    chimneyValue: 'Yes',
                    weight: 4,
                    options: ['Yes', 'No']
                },
                'Email support (SLA response with 1 business day)': {
                    description: 'Email response with a guaranteed 24 hour response SLA?',
                    chimneyValue: 'Yes',
                    weight: 4,
                    options: ['Yes', 'No']
                },
                'Chat support': {
                    description: 'Ability for in-platform support during business hours in the platform?',
                    chimneyValue: 'Yes',
                    weight: 3,
                    options: ['Yes', 'No']
                },
                'Help Center': {
                    description: 'Self help articles and support for all technology questions?',
                    chimneyValue: 'Yes',
                    weight: 3,
                    options: ['Yes', 'No']
                },
                'Technical Account Manager': {
                    description: 'A human assigned to your account to help whenever technical questions comes up.',
                    chimneyValue: 'Yes',
                    weight: 4,
                    options: ['Yes', 'No']
                }
            }
        },
        'Admin': {
            description: 'Administrative features and capabilities',
            features: {
                'Flexible contracts': {
                    description: 'Do we have the ability to work on a flexible contract?',
                    chimneyValue: 'Yes',
                    weight: 3,
                    options: ['Yes', 'No']
                },

                'Billing': {
                    description: 'Pay with a credit card or ACH for larger businesses',
                    chimneyValue: 'Yes',
                    weight: 3,
                    options: ['Yes', 'No']
                }
            }
        }
    };

    const defaultVendors = [
        { 
            name: 'Chimney',
            displayName: 'Chimney',
            scores: {}
        },
        {
            name: 'Leadfusion',
            displayName: 'Leadfusion',
            scores: {}
        },
        {
            name: 'Fintactix',
            displayName: 'Fintactix',
            scores: {}
        },
        {
            name: 'TimeValue',
            displayName: 'TimeValue',
            scores: {}
        }
    ];

    const [vendors, setVendors] = useState(defaultVendors);
    const [selectedVendors, setSelectedVendors] = useState(['Chimney', 'Leadfusion']);

    const handleScoreChange = (vendorIndex, category, feature, value) => {
        const newVendors = [...vendors];
        if (!newVendors[vendorIndex].scores[category]) {
            newVendors[vendorIndex].scores[category] = {};
        }
        newVendors[vendorIndex].scores[category][feature] = value;
        setVendors(newVendors);
    };

    const calculateCategoryScore = (vendorIndex, category) => {
        const features = categories[category].features;
        let totalWeight = 0;
        let score = 0;

        Object.entries(features).forEach(([feature, details]) => {
            const value = vendors[vendorIndex].name === 'Chimney' 
                ? details.chimneyValue 
                : vendors[vendorIndex].scores[category]?.[feature];
            
            if (value) {
                const weight = details.weight;
                totalWeight += weight;
                
                if (value === 'Yes' || value === 'SOC 2 Certified' || value === '1-2 days') {
                    score += weight;
                } else if (value === 'Requires custom development' || value === 'In Process' || value === '30-60 days') {
                    score += weight * 0.5;
                } else if (value === 'Limited' || value === '60-90 days') {
                    score += weight * 0.25;
                }
            }
        });

        return totalWeight > 0 ? ((score / totalWeight) * 100).toFixed(1) : 0;
    };

    const calculateTotalScore = (vendorIndex) => {
        let totalScore = 0;
        let totalWeight = 0;

        Object.entries(categories).forEach(([category, catDetails]) => {
            Object.entries(catDetails.features).forEach(([feature, details]) => {
                const value = vendors[vendorIndex].name === 'Chimney'
                    ? details.chimneyValue
                    : vendors[vendorIndex].scores[category]?.[feature];
                
                if (value) {
                    const weight = details.weight;
                    totalWeight += weight;
                    
                    if (value === 'Yes' || value === 'SOC 2 Certified' || value === '1-2 days') {
                        totalScore += weight;
                    } else if (value === 'Requires custom development' || value === 'In Process' || value === '30-60 days') {
                        totalScore += weight * 0.5;
                    } else if (value === 'Limited' || value === '60-90 days') {
                        totalScore += weight * 0.25;
                    }
                }
            });
        });

        return totalWeight > 0 ? ((totalScore / totalWeight) * 100).toFixed(1) : 0;
    };

    const toggleVendor = (vendor) => {
        if (vendor === 'Chimney') return; // Prevent toggling Chimney
        setSelectedVendors(prev => 
            prev.includes(vendor)
                ? prev.filter(v => v !== vendor)
                : [...prev, vendor]
        );
    };

    return (
        <div className="container mx-auto py-8 px-4 max-w-7xl">
            <div className="bg-white rounded-lg shadow-lg p-6 mb-8">
                <h1 className="text-4xl font-bold mb-3 text-gray-900">Financial Calculator Vendor Comparison</h1>
                <p className="text-gray-600 mb-8 text-lg">
                    Compare calculator vendors across key criteria that matter most to financial institutions.
                </p>

                <div className="mb-8">
                    <h2 className="text-xl font-semibold mb-4">Select Vendors to Compare</h2>
                    <div className="flex flex-wrap gap-4">
                        {vendors.map(vendor => (
                            <button
                                key={vendor.name}
                                onClick={() => toggleVendor(vendor.name)}
                                className={`px-4 py-2 rounded-full transition-all ${
                                    selectedVendors.includes(vendor.name)
                                        ? 'bg-blue-500 text-white shadow-md'
                                        : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                }`}
                            >
                                {vendor.displayName}
                            </button>
                        ))}
                    </div>
                </div>

                <div className="mb-8">
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        {selectedVendors.map((vendor, index) => {
                            const vendorIndex = vendors.findIndex(v => v.name === vendor);
                            const score = calculateTotalScore(vendorIndex);
                            return (
                                <div key={vendor} 
                                    className={`p-6 rounded-lg score-card ${
                                        vendor === 'Chimney' 
                                            ? 'bg-blue-50 border-2 border-blue-200'
                                            : 'bg-white border border-gray-200'
                                    }`}
                                >
                                    <div className="text-lg font-semibold mb-2">{vendor}</div>
                                    <div className="text-3xl font-bold mb-1">{score}%</div>
                                    <div className="text-sm text-gray-600">Overall Score</div>
                                </div>
                            );
                        })}
                    </div>
                </div>

                {Object.entries(categories).map(([category, { description, features }]) => (
                    <div key={category} className="mb-8">
                        <h2 className="text-2xl font-bold mb-2">{category}</h2>
                        <p className="text-gray-600 mb-4">{description}</p>
                        <div className="bg-gray-50 p-6 rounded-lg">
                            {Object.entries(features).map(([feature, details]) => (
                                <div key={feature} className="mb-6 feature-row">
                                    <div className="grid grid-cols-[2fr,repeat(auto-fit,1fr)] gap-4">
                                        <div>
                                            <h3 className="font-semibold">{feature}</h3>
                                            <p className="text-sm text-gray-600">{details.description}</p>
                                        </div>
                                        {selectedVendors.map((vendor) => {
                                            const vendorIndex = vendors.findIndex(v => v.name === vendor);
                                            const vendorObj = vendors[vendorIndex];
                                            const currentValue = vendor === 'Chimney' 
                                                ? details.chimneyValue 
                                                : vendorObj.scores[category]?.[feature] || '';
                                            
                                            return (
                                                <div key={vendor} className="text-center">
                                                    <select
                                                        value={currentValue}
                                                        onChange={(e) => handleScoreChange(
                                                            vendorIndex,
                                                            category,
                                                            feature,
                                                            e.target.value
                                                        )}
                                                        className={`w-full p-2 border rounded transition-all ${
                                                            vendor === 'Chimney' 
                                                                ? 'bg-blue-50 border-blue-200' 
                                                                : 'hover:border-gray-400'
                                                        }`}
                                                        disabled={vendor === 'Chimney'}
                                                    >
                                                        <option value="">Select {vendorObj.displayName}...</option>
                                                        {details.options.map(option => (
                                                            <option key={option} value={option}>
                                                                {option}
                                                            </option>
                                                        ))}
                                                    </select>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>
                            ))}
                            <div className="mt-4 p-4 bg-white rounded-lg shadow">
                                <div className="grid grid-cols-[2fr,repeat(auto-fit,1fr)] gap-4">
                                    <div className="font-semibold">Category Score</div>
                                    {selectedVendors.map((vendor) => {
                                        const vendorIndex = vendors.findIndex(v => v.name === vendor);
                                        return (
                                            <div key={vendor} className="text-center font-semibold">
                                                {calculateCategoryScore(vendorIndex, category)}%
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        </div>
                    </div>
                ))}
            </div>
            
            <div className="mt-16 bg-gray-50 p-8 rounded-lg">
                <h2 className="text-2xl font-semibold mb-4">Understanding the Scoring System</h2>
                <div className="space-y-4">
                    <p className="text-gray-700">Our comparison tool uses a weighted scoring system that prioritizes the features that matter most to financial institutions:</p>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div className="bg-white p-6 rounded-lg shadow-sm">
                            <h3 className="font-semibold mb-2">Feature Weights (1-5)</h3>
                            <ul className="space-y-2">
                                <li className="flex items-center">
                                    <span className="w-8 h-8 flex items-center justify-center bg-blue-100 text-blue-800 rounded-full font-semibold mr-3">5</span>
                                    <span className="text-gray-700">Critical features (ADA compliance, security, uptime)</span>
                                </li>
                                <li className="flex items-center">
                                    <span className="w-8 h-8 flex items-center justify-center bg-blue-50 text-blue-600 rounded-full font-semibold mr-3">4</span>
                                    <span className="text-gray-700">High-impact features (analytics, customization)</span>
                                </li>
                                <li className="flex items-center">
                                    <span className="w-8 h-8 flex items-center justify-center bg-gray-100 text-gray-600 rounded-full font-semibold mr-3">3</span>
                                    <span className="text-gray-700">Supporting features (auxiliary tools, additional options)</span>
                                </li>
                            </ul>
                        </div>
                        
                        <div className="bg-white p-6 rounded-lg shadow-sm">
                            <h3 className="font-semibold mb-2">Score Calculation</h3>
                            <ul className="space-y-2">
                                <li className="flex items-center">
                                    <span className="w-8 h-8 flex items-center justify-center bg-green-100 text-green-800 rounded-full font-semibold mr-3">100%</span>
                                    <span className="text-gray-700">"Yes" / "SOC 2 Certified" / "Less than 24 hours"</span>
                                </li>
                                <li className="flex items-center">
                                    <span className="w-8 h-8 flex items-center justify-center bg-yellow-50 text-yellow-600 rounded-full font-semibold mr-3">50%</span>
                                    <span className="text-gray-700">"Requires custom development" / "In Process"</span>
                                </li>
                                <li className="flex items-center">
                                    <span className="w-8 h-8 flex items-center justify-center bg-red-50 text-red-600 rounded-full font-semibold mr-3">25%</span>
                                    <span className="text-gray-700">"Limited" functionality or extended timelines</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                    
                    <p className="text-gray-600 text-sm">Each category's score is calculated by summing the weighted scores of its features and dividing by the total possible points. The overall score is an aggregate of all category scores, ensuring a comprehensive evaluation of each vendor's capabilities.</p>
                </div>
            </div>
        </div>
    );
};

export default ComparisonTool;
